<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="simdata">
<title>simdata: A package for creating simulated datasets • simdata</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="simdata: A package for creating simulated datasets">
<meta property="og:description" content="simdata">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">simdata</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0.9003</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Demo.html">simdata: A package for creating simulated datasets</a>
    <a class="dropdown-item" href="../articles/NORTA_demo.html">simdata: NORTA based simulation designs</a>
    <a class="dropdown-item" href="../articles/Technical_documentation.html">simdata: Technical documentation</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/matherealize/simdata/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>simdata: A package for creating simulated datasets</h1>
                        <h4 data-toc-skip class="author">Michael
Kammer</h4>
            
            <h4 data-toc-skip class="date">2023-08-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/matherealize/simdata/blob/HEAD/vignettes/Demo.Rmd" class="external-link"><code>vignettes/Demo.Rmd</code></a></small>
      <div class="d-none name"><code>Demo.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Simulation studies in statistics or other methodological research
fields are controlled experiments used to assess the properties of
algorithms, gauge the performance of statistical or machine learning
models, and gain insights into complex phenomena which are not readily
understood analytically. While simulation studies by nature are
simplifying the “true” underlying mechanisms of interest, they are
useful because they allow the complete specification of the “ground
truth” to which comparisons can be made and the experimental conditions
are fully under control of the experimenter. This is in contrast to data
obtained from observational studies, in which many factors may influence
the resulting measurements.</p>
<p>Simulation studies typically consist of three major components:</p>
<ul>
<li>A data generating mechanism</li>
<li>The methods or models to be evaluated</li>
<li>Evaluation criteria to assess the methods after application to the
generated data</li>
</ul>
<p>All three together make up what we will call the <em>simulation study
design</em>.</p>
<p>The data generating mechanism usually simulates (i.e. creates) data
according to pre-defined parameters, e.g. the number of variables
(i.e. columns of the data matrix) to be generated, their correlation
structure or the number of observations (i.e. rows of the data matrix).
Usually, the data generation involves some uncertainty or noise when
creating the data, to mimic the uncertainty when data is obtained
through measurements in the real world or sampled from a population.
Therefore, each simulation scenario can be conducted repeatedly to
remove the effect of sampling variability.</p>
<p>The methods or models to be evaluated in the study are then applied
to the datasets generated by the data generating mechanism and the
evaluation criteria are computed, e.g. some measure of deviation from
the ground truth.</p>
<div class="section level3">
<h3 id="data-generation-with-this-package">Data generation with this package<a class="anchor" aria-label="anchor" href="#data-generation-with-this-package"></a>
</h3>
<p>The goal of the <code>simdata</code> package is to provide a simple
yet flexible framework which supports the first step of a simulation
study, namely the data generating mechanism.</p>
<p>The way data is created in this package involves the following
procedure:</p>
<ol style="list-style-type: decimal">
<li>Draw an initial dataset <code>Z</code> from some probability
distribution. An example might be to draw a number of variables with
given correlation structure from a multivariate Normal
distribution.</li>
<li>The initial data is then transformed via user specified
transformation functions into the final dataset <code>X</code>. Examples
for transformations could be to derive binary variables from Normal
random variables or to change location and scale of the initial random
variables.</li>
<li>The final dataset is optionally post-processed. Examples are to
truncate the dataset to prevent problematic outliers or to standardize
the data.</li>
</ol>
<p>After these steps, the final dataset <code>X</code> can be used in
the further steps of the simulation study.</p>
</div>
<div class="section level3">
<h3 id="workflow-with-this-package">Workflow with this package<a class="anchor" aria-label="anchor" href="#workflow-with-this-package"></a>
</h3>
<p>In order to implement the outlined data generating mechanism, the
user first has to define a simulation design. This is done by extending
the S3 class <code>simdesign</code>, or using one of the pre-defined
simulation designs, which is used to as an interface for further package
functions. It stores all necessary information to generate data
following the given specification. The actual data generation then
happens in the <code>simulate_data</code> function. Please see the
numerous examples below to quickly familiarize yourself with the package
functionality.</p>
</div>
<div class="section level3">
<h3 id="packages-used">Packages used<a class="anchor" aria-label="anchor" href="#packages-used"></a>
</h3>
<p>This vignette makes use of the <a href="https://www.tidyverse.org/" class="external-link"><code>tidyverse</code></a> environment
of packages and specifically requires the <code>dplyr</code>,
<code>purrr</code>, <code>ggplot2</code>, <code>forcats</code> and
<code>GGally</code> packages to be available, as well as the
<code>reshape2</code> package for data transformation. Furthermore, for
the <a href="#parallel">parallelization example</a> the
<code>doParallel</code> and <code>doRNG</code> package are loaded.
Please refer to <a href="#rsession">the R environment used to create
this vignette</a> for detailed information. In this vignette we will
prefix all relevant function calls by <code>::</code> to show the
package which implements the function - this is not necessary but only
done for demonstration purposes.</p>
</div>
</div>
<div class="section level2">
<h2 id="example-1-independent-data-no-transformation">Example 1: Independent data, no transformation<a class="anchor" aria-label="anchor" href="#example-1-independent-data-no-transformation"></a>
</h2>
<p>We demonstrate a very basic example here:</p>
<ul>
<li>Setup a design to sample from 5 independent normal variables
<ul>
<li>Define a diagonal 5 x 5 correlation matrix
(<code>correlation_matrix</code>)</li>
<li>Ensure that the data is returned as a data.frame by passing the
<code>data.frame</code> constructor to <code>transform_initial</code>.
(Otherwise the data would be returned as a matrix.)</li>
<li>Pass a prefix to the function to construct variable names</li>
</ul>
</li>
<li>Simulate from the design to obtain 100 observations
(<code>n_obs</code>) with a given random seed (<code>seed</code>).</li>
<li>Inspect the simulated data.</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">correlation_matrix</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1</span>, nrow <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_design</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/simdesign_mvtnorm.html">simdesign_mvtnorm</a></span><span class="op">(</span>relations <span class="op">=</span> <span class="va">correlation_matrix</span>, </span>
<span>                                        transform_initial <span class="op">=</span> <span class="va">data.frame</span>,</span>
<span>                                        prefix_final <span class="op">=</span> <span class="st">"variable"</span><span class="op">)</span></span>
<span><span class="va">sim_data</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/simulate_data.html">simulate_data</a></span><span class="op">(</span><span class="va">sim_design</span>, n_obs <span class="op">=</span> <span class="fl">100</span>, seed <span class="op">=</span> <span class="fl">25897165</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sim_data</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">variable1</th>
<th align="right">variable2</th>
<th align="right">variable3</th>
<th align="right">variable4</th>
<th align="right">variable5</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">-0.4083281</td>
<td align="right">1.3494810</td>
<td align="right">0.6183227</td>
<td align="right">-0.5885417</td>
<td align="right">0.9910670</td>
</tr>
<tr class="even">
<td align="right">-1.3882168</td>
<td align="right">-1.3453283</td>
<td align="right">-0.8755803</td>
<td align="right">-0.2168642</td>
<td align="right">-2.3119306</td>
</tr>
<tr class="odd">
<td align="right">-0.9298047</td>
<td align="right">-0.2462345</td>
<td align="right">0.1028683</td>
<td align="right">-0.5223406</td>
<td align="right">-0.4701425</td>
</tr>
<tr class="even">
<td align="right">1.3110934</td>
<td align="right">-1.0087735</td>
<td align="right">-0.6052583</td>
<td align="right">2.0218711</td>
<td align="right">0.8146569</td>
</tr>
<tr class="odd">
<td align="right">-1.2179351</td>
<td align="right">-0.8560356</td>
<td align="right">-2.6381571</td>
<td align="right">-0.0863500</td>
<td align="right">0.3438921</td>
</tr>
<tr class="even">
<td align="right">0.3504726</td>
<td align="right">-0.1930905</td>
<td align="right">-1.0631527</td>
<td align="right">-1.0101591</td>
<td align="right">0.6001550</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">=</span> <span class="fu">GGally</span><span class="fu">::</span><span class="fu"><a href="https://ggobi.github.io/ggally/reference/ggpairs.html" class="external-link">ggpairs</a></span><span class="op">(</span><span class="va">sim_data</span>, </span>
<span>                    upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>continuous <span class="op">=</span> <span class="st">"points"</span><span class="op">)</span>, </span>
<span>                    progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code></pre></div>
<p><img src="Demo_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="ex2">Example 2: Independent data, with transformation<a class="anchor" aria-label="anchor" href="#ex2"></a>
</h2>
<p>In this example we transform the initial data to obtain a more
interesting dataset. The basic principle follows <a href="ex1">Example
1</a>.</p>
<ul>
<li>Create a transformation function <code>transformation</code> using
<code><a href="../reference/function_list.html">simdata::function_list</a></code>
<ul>
<li>Pass functions that transform the columns of the simulated, initial
dataset as named arguments</li>
<li>The number of columns in the final dataset is given by the number of
transformations passed here</li>
<li>To let the names of the arguments determine the final columnnames,
set <code>prefix_final</code> to NULL in the <code>simdesign</code>
constructor</li>
</ul>
</li>
<li>Pass the created transformation function as
<code>transform_initial</code> argument to the <code>simdesign</code>
constructor.</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">correlation_matrix</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1</span>, nrow <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">transformation</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/function_list.html">function_list</a></span><span class="op">(</span></span>
<span>  <span class="st">"v1"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,</span>
<span>  <span class="st">"v2*2"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="fl">2</span>, </span>
<span>  <span class="st">"v3^2"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span>,</span>
<span>  <span class="st">"v4+v5"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span>, <span class="fl">4</span><span class="op">]</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span>, <span class="fl">5</span><span class="op">]</span>, </span>
<span>  check.names <span class="op">=</span> <span class="cn">FALSE</span> <span class="co"># pass columnnames exactly as specified here</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_design</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/simdesign_mvtnorm.html">simdesign_mvtnorm</a></span><span class="op">(</span></span>
<span>  relations <span class="op">=</span> <span class="va">correlation_matrix</span>,</span>
<span>  transform_initial <span class="op">=</span> <span class="va">transformation</span>, </span>
<span>  prefix_final <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span><span class="va">sim_data</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/simulate_data.html">simulate_data</a></span><span class="op">(</span><span class="va">sim_design</span>, n_obs <span class="op">=</span> <span class="fl">100</span>, seed <span class="op">=</span> <span class="fl">25897165</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sim_data</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">v1</th>
<th align="right">v2*2</th>
<th align="right">v3^2</th>
<th align="right">v4+v5</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">-0.4083281</td>
<td align="right">2.6989619</td>
<td align="right">0.3823229</td>
<td align="right">0.4025253</td>
</tr>
<tr class="even">
<td align="right">-1.3882168</td>
<td align="right">-2.6906566</td>
<td align="right">0.7666409</td>
<td align="right">-2.5287948</td>
</tr>
<tr class="odd">
<td align="right">-0.9298047</td>
<td align="right">-0.4924690</td>
<td align="right">0.0105819</td>
<td align="right">-0.9924831</td>
</tr>
<tr class="even">
<td align="right">1.3110934</td>
<td align="right">-2.0175470</td>
<td align="right">0.3663376</td>
<td align="right">2.8365280</td>
</tr>
<tr class="odd">
<td align="right">-1.2179351</td>
<td align="right">-1.7120713</td>
<td align="right">6.9598728</td>
<td align="right">0.2575421</td>
</tr>
<tr class="even">
<td align="right">0.3504726</td>
<td align="right">-0.3861811</td>
<td align="right">1.1302936</td>
<td align="right">-0.4100041</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">=</span> <span class="fu">GGally</span><span class="fu">::</span><span class="fu"><a href="https://ggobi.github.io/ggally/reference/ggpairs.html" class="external-link">ggpairs</a></span><span class="op">(</span><span class="va">sim_data</span>, upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>continuous <span class="op">=</span> <span class="st">"points"</span><span class="op">)</span>, </span>
<span>                    progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code></pre></div>
<p><img src="Demo_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="ex3">Example 3: Realistic, complex data<a class="anchor" aria-label="anchor" href="#ex3"></a>
</h2>
<p>In this example we implement a design following <span class="citation">Binder, Sauerbrei, and Royston (2011)</span>. The
simulated data resembles data obtained from a biomedical study with a
complex correlation pattern and different variable distributions.</p>
<ul>
<li>Create a complex initial correlation matrix comfortably using
<code><a href="../reference/cor_from_upper.html">simdata::cor_from_upper</a></code>
<ul>
<li>This defines the initial distribution as a multivariate Normal
distribution <code>Z</code> with 15 dimensions</li>
</ul>
</li>
<li>Use a variety of transformations to create numeric, binary and
ordinal variables
<ul>
<li>Using the transformation the initial distribution <code>Z</code> is
transformed to the final dataset <code>X</code> with 17 columns</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">correlation_matrix</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/cor_from_upper.html">cor_from_upper</a></span><span class="op">(</span></span>
<span>  <span class="fl">15</span>, </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">0.8</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">9</span>,<span class="fl">0.3</span><span class="op">)</span>, </span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">0.3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">9</span>,<span class="op">-</span><span class="fl">0.5</span><span class="op">)</span>, </span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">6</span>,<span class="op">-</span><span class="fl">0.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">7</span>,<span class="op">-</span><span class="fl">0.3</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">6</span>,<span class="op">-</span><span class="fl">0.3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">12</span>,<span class="fl">0.5</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">7</span>,<span class="fl">0.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">11</span>,<span class="fl">0.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">14</span>,<span class="fl">0.3</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>,<span class="fl">11</span>,<span class="fl">0.3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>,<span class="fl">14</span>,<span class="fl">0.3</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>,<span class="fl">9</span>,<span class="op">-</span><span class="fl">0.3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>,<span class="fl">11</span>,<span class="fl">0.3</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">11</span>,<span class="fl">14</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">transformation</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/function_list.html">function_list</a></span><span class="op">(</span></span>
<span>  v1 <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fl">10</span> <span class="op">*</span> <span class="va">z</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">55</span><span class="op">)</span>, </span>
<span>  v2 <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="va">z</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;</span> <span class="fl">0.6</span>, </span>
<span>  v3 <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fl">0.4</span> <span class="op">*</span> <span class="va">z</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">+</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>  v4 <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="va">z</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">&gt;=</span> <span class="op">-</span><span class="fl">1.2</span>,</span>
<span>  v5 <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="va">z</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">&gt;=</span> <span class="fl">0.75</span>,</span>
<span>  v6 <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fl">0.5</span> <span class="op">*</span> <span class="va">z</span><span class="op">[</span>,<span class="fl">5</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1.5</span><span class="op">)</span>,</span>
<span>  v7 <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">z</span><span class="op">[</span>,<span class="fl">6</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  v8 <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">80</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">z</span><span class="op">[</span>,<span class="fl">7</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  v9 <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="va">z</span><span class="op">[</span>,<span class="fl">8</span><span class="op">]</span> <span class="op">&lt;</span> <span class="op">-</span><span class="fl">0.35</span>,</span>
<span>  v10 <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">(</span><span class="va">z</span><span class="op">[</span>,<span class="fl">9</span><span class="op">]</span> <span class="op">&gt;=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">z</span><span class="op">[</span>,<span class="fl">9</span><span class="op">]</span> <span class="op">&lt;</span> <span class="fl">1.5</span><span class="op">)</span>,</span>
<span>  v11 <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="va">z</span><span class="op">[</span>,<span class="fl">9</span><span class="op">]</span> <span class="op">&gt;=</span> <span class="fl">1.5</span>,</span>
<span>  v12 <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="fl">0.01</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="op">(</span><span class="va">z</span><span class="op">[</span>,<span class="fl">10</span><span class="op">]</span> <span class="op">+</span> <span class="fl">4</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>  v13 <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fl">10</span> <span class="op">*</span> <span class="va">z</span><span class="op">[</span>,<span class="fl">11</span><span class="op">]</span> <span class="op">+</span> <span class="fl">55</span><span class="op">)</span>,</span>
<span>  v14 <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fl">10</span> <span class="op">*</span> <span class="va">z</span><span class="op">[</span>,<span class="fl">12</span><span class="op">]</span> <span class="op">+</span> <span class="fl">55</span><span class="op">)</span>,</span>
<span>  v15 <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fl">10</span> <span class="op">*</span> <span class="va">z</span><span class="op">[</span>,<span class="fl">13</span><span class="op">]</span> <span class="op">+</span> <span class="fl">55</span><span class="op">)</span>,</span>
<span>  v16 <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="va">z</span><span class="op">[</span>,<span class="fl">14</span><span class="op">]</span> <span class="op">&lt;</span> <span class="fl">0</span>,</span>
<span>  v17 <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="va">z</span><span class="op">[</span>,<span class="fl">15</span><span class="op">]</span> <span class="op">&lt;</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_design</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/simdesign_mvtnorm.html">simdesign_mvtnorm</a></span><span class="op">(</span></span>
<span>  relations <span class="op">=</span> <span class="va">correlation_matrix</span>,</span>
<span>  transform_initial <span class="op">=</span> <span class="va">transformation</span>,</span>
<span>  prefix_final <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="visualisation-of-initial-correlation-matrix">Visualisation of initial correlation matrix<a class="anchor" aria-label="anchor" href="#visualisation-of-initial-correlation-matrix"></a>
</h3>
<p>We can display the correlation matrix of the initial underlying
distribution using <code>ggplot2</code>. Or we can use the graph
plotting tools from this package to display a basic correlation
network.</p>
<p><img src="Demo_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>Or we can use the simple graph visualisation provided by this
package. To keep this graph simple, correlations below a certain
threshold are removed. The <code><a href="../reference/plot_cor_network.html">simdata::plot_cor_network</a></code>
function provides several options to improve display of the graph, some
of which are explained in more detail <a href="#plotestcor">below</a>.
Here we just point out that the layout of the network is based on the
Fruchterman-Reingold algorithm as implemented in the <code>igraph</code>
package and therefore comprises random parts. Therefore, using a seed
for the random number generation is advised.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_cor_network.html">plot_cor_network</a></span><span class="op">(</span><span class="va">sim_design</span>, seed <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="Demo_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="simfinal">Simulation and visualisation of final data<a class="anchor" aria-label="anchor" href="#simfinal"></a>
</h3>
<p>We simulate from the design and visualise numeric variables via
violinplots and discrete variables via barplots using
<code>ggplot2</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_data</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/simulate_data.html">simulate_data</a></span><span class="op">(</span><span class="va">sim_design</span>, n_obs <span class="op">=</span> <span class="fl">100</span>, seed <span class="op">=</span> <span class="fl">25897165</span><span class="op">)</span></span></code></pre></div>
<p><img src="Demo_files/figure-html/unnamed-chunk-8-1.png" width="700"><img src="Demo_files/figure-html/unnamed-chunk-8-2.png" width="700"></p>
<p>We can also plot the correlation structure of the single, final
dataset via the correlation matrix and visualise it using
<code>ggplot2</code> or as a network using the functions provided by
this package.</p>
<p><img src="Demo_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="plotestcor">Visualisation of estimated correlation network<a class="anchor" aria-label="anchor" href="#plotestcor"></a>
</h3>
<p>Note that the above correlation matrix is based on a single simulated
dataset of a fixed size. To provide a robust and stable estimate of the
correlation after transforming the initial dataset, one can employ
approximation by simulation, as the initial correlation structure is
affected by the data transformation and can not be analytically
expressed in all cases. This can conveniently be achieved using
<code>estimate_final_correlation</code>. The resulting correlation
network can be visualized via <code>plot_cor_network</code> or by
<code>plot_estimated_cor_network</code> which combines the estimation of
the correlation matrix and the network plotting into one wrapper
function.</p>
<p>Note that the layout algorithm of <code>igraph</code> computes a
similar layout for initial and final correlation structure, given some
manual tweaking of the random seed. This probably does not hold for all
setups, but if the initial and final layout are somewhat similar
(i.e. after proper pruning via cutting of low correlations), the
resulting graphs may reflect that.</p>
<p>We demonstrate some basic plotting functionality (the arguments are
identical for <code>plot_cor_network</code>):</p>
<ul>
<li>Draw all edges in the graph by setting <code>cor_cutoff</code> to
NULL</li>
<li>Turn off edge labeling by setting <code>edge_label_function</code>
to NULL</li>
<li>Controling edge width using <code>edge_width_function</code>
</li>
<li>Using edge weights (i.e. correlation between two variables) to
influence the graph layout via <code>use_edge_weights</code> - higher
edge weight brings vertices closer together</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># draw full network</span></span>
<span><span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_estimated_cor_network.html">plot_estimated_cor_network</a></span><span class="op">(</span><span class="va">sim_design</span>, </span>
<span>                                    cor_cutoff <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>                                    edge_label_function <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                                    edge_width_function <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">*</span><span class="fl">25</span>,</span>
<span>                                    use_edge_weights <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                                    edge.color <span class="op">=</span> <span class="st">"clipped-ramp"</span>,</span>
<span>                                    seed <span class="op">=</span> <span class="fl">2321673</span><span class="op">)</span></span></code></pre></div>
<p><img src="Demo_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>The following graphs all use the default correlation cutoff of
0.1.</p>
<ul>
<li>Switching correlation type to Spearman using <code>cor_type</code>
<ul>
<li>Note that when edge weights are used, then the networks for
different correlation types can not be compared directly, as the vertex
layout may change</li>
</ul>
</li>
<li>Setting various other parameters
<ul>
<li>Note the usage of <code>mar</code> to set the image margins to make
the axes visisble</li>
<li>Note that distinction between categorical and numeric data is turned
off (<code>show_categorical</code>)</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># simplify by using cor_cutoff</span></span>
<span><span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_estimated_cor_network.html">plot_estimated_cor_network</a></span><span class="op">(</span><span class="va">sim_design</span>, </span>
<span>                                    seed <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="Demo_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set correlation type</span></span>
<span><span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_estimated_cor_network.html">plot_estimated_cor_network</a></span><span class="op">(</span><span class="va">sim_design</span>, </span>
<span>                                    cor_type <span class="op">=</span> <span class="st">"spearman"</span>, </span>
<span>                                    seed <span class="op">=</span> <span class="fl">2321673</span><span class="op">)</span></span></code></pre></div>
<p><img src="Demo_files/figure-html/unnamed-chunk-11-2.png" width="700"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set various parameters</span></span>
<span><span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_estimated_cor_network.html">plot_estimated_cor_network</a></span><span class="op">(</span><span class="va">sim_design</span>, seed <span class="op">=</span> <span class="fl">2321673</span>, </span>
<span>                                    edge.color <span class="op">=</span> <span class="st">"red-blue"</span>, </span>
<span>                                    axes <span class="op">=</span> <span class="cn">TRUE</span>, cor_type <span class="op">=</span> <span class="st">"s"</span>, </span>
<span>                                    edge_width_function <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">*</span><span class="fl">200</span>,</span>
<span>                                    show_categorical <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                                    mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Demo_files/figure-html/unnamed-chunk-11-3.png" width="700"></p>
<p>In all of these plots it is evident that the dataset contains a tight
cluster of highly correlated variables (especially
<code>v4, v5, v7, v8, v13, v16</code>) but also quite independent
variables (<code>v12, v15, v17</code>). Some are also only connected to
the network via one other variable (<code>v2, v14</code>). Thanks to the
network layout of the plot, which is often more intelligible than a
plain correlation matrix, this quite clearly shows the rich variety of
correlation patterns within the simulated data.</p>
</div>
<div class="section level3">
<h3 id="post-processing">Post-processing<a class="anchor" aria-label="anchor" href="#post-processing"></a>
</h3>
<p>Post-processing can be used to apply a number of functions to the
dataset before it is returned by <code>simulate_data</code>. This is
useful to e.g.  standardize and truncate data, as shown below.</p>
<p>To add post-processing functions to the <code>simdesign</code>
object, simply pass a list to the constructor or add it directly to the
object. Each entry has a name (name of a function) and is a list with
named arguments passed to the function (if default parameters should be
used simply pass an empty list). See the <code>do_processing</code> help
for further details. The simulation of the data does not need to be
changed in any way.</p>
<div class="section level4">
<h4 id="truncation">Truncation<a class="anchor" aria-label="anchor" href="#truncation"></a>
</h4>
<ul>
<li>Add truncation to the post-processing via
<code>process_truncate_by_iqr</code>
<ul>
<li>Truncation is only added for specific numeric variables by passing a
named vector</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_design</span><span class="op">$</span><span class="va">process_final</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    process_truncate_by_iqr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        truncate_multipliers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>v6 <span class="op">=</span> <span class="fl">2</span>, v7 <span class="op">=</span> <span class="fl">2</span>, v8 <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_data</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/simulate_data.html">simulate_data</a></span><span class="op">(</span><span class="va">sim_design</span>, n_obs <span class="op">=</span> <span class="fl">100</span>, seed <span class="op">=</span> <span class="fl">25897165</span><span class="op">)</span></span></code></pre></div>
<p>Compare the results with the <a href="#simfinal">results before</a>
and note the truncation in the specified variables
(<code>v6, v7, v8</code>).</p>
<p><img src="Demo_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>Note that the above truncation is based on statistics derived from
each individual simulated dataset. To implement truncation based on
statistics derived from the data generating mechanism itself, one can 1)
simulate a reasonably large, untruncated dataset, 2) derive the desired
upper and lower truncation thresholds, and 3) add
<code>process_truncate_by_threshold</code> with the derived truncation
thresholds to the simulator object to truncate by fixed tresholds in
every simulation run. Truncation can be done independently for lower and
upper thresholds (see example below).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_design</span><span class="op">$</span><span class="va">process_final</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    process_truncate_by_threshold <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        truncate_upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>v8 <span class="op">=</span> <span class="fl">200</span>, v7 <span class="op">=</span> <span class="fl">300</span><span class="op">)</span>,</span>
<span>        truncate_lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>v6 <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_data</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/simulate_data.html">simulate_data</a></span><span class="op">(</span><span class="va">sim_design</span>, n_obs <span class="op">=</span> <span class="fl">100</span>, seed <span class="op">=</span> <span class="fl">25897165</span><span class="op">)</span></span></code></pre></div>
<p>Compare the results with the <a href="#simfinal">results before</a>
and note the truncation in the specified variables
(<code>v6, v7, v8</code>).</p>
<p><img src="Demo_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="standardization">Standardization<a class="anchor" aria-label="anchor" href="#standardization"></a>
</h4>
<p>Similarly, standardization can be applied using the standard
<code>scale</code> function, changing the scale on the y-axis of the
following plots. Note that the order of functions passed via
<code>process_final</code> is important. Since
<code><a href="https://rdrr.io/r/base/scale.html" class="external-link">base::scale()</a></code> returns a <code>matrix</code>, we also want
to transform the result back to a <code>data.frame</code> in the
end.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_design</span><span class="op">$</span><span class="va">process_final</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    process_truncate_by_iqr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        truncate_multipliers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>v6 <span class="op">=</span> <span class="fl">2</span>, v7 <span class="op">=</span> <span class="fl">2</span>, v8 <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="op">)</span>, </span>
<span>    scale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>    data.frame <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_data</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/simulate_data.html">simulate_data</a></span><span class="op">(</span><span class="va">sim_design</span>, n_obs <span class="op">=</span> <span class="fl">100</span>, seed <span class="op">=</span> <span class="fl">25897165</span><span class="op">)</span></span></code></pre></div>
<p><img src="Demo_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="advanced-simulation-setup">Advanced simulation setup<a class="anchor" aria-label="anchor" href="#advanced-simulation-setup"></a>
</h2>
<p>In the following we briefly present some more advanced usage aspects
of the package.</p>
<div class="section level3">
<h3 id="rejection-sampling">Rejection sampling<a class="anchor" aria-label="anchor" href="#rejection-sampling"></a>
</h3>
<p>A very simple form of rejection sampling is implemented in the
<code>simulate_data_conditional</code> function, which only accepts a
final dataset if it fulfills some specified conditions. This can be
useful to prevent issues during simulation runs when the simulated data
is e.g. likely to produce collinear matrices due to high dependencies
between the variables or if some of them produce low variance
variables.</p>
<p>Note that such an approach can lead to serious bias in the
simulations if the rejection rate is very high. Thus, it might be
necessary to revise such a setup or at least record the number of
rejections for reporting purposes (as facilitated by the
<code>return_tries</code> option of the function).</p>
<p>Usually rejections should occur very rarely. In this case the
<code>simulate_data_conditional</code> function can be used to let the
simulation run smoothly or let the calling function decide on how to
handle rejections.</p>
<p>To show an example, we set up a very simple simulation with two
variables and make them collinear on purpose via a transformation.</p>
<ul>
<li>The <code>is_collinear</code> function from this package is used to
check for collinearity</li>
<li>After at most three runs with rejected datasets the function returns
(<code>reject_max_iter</code>)</li>
<li>The number of tries is returned in a list
(<code>return_tries</code>)</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">correlation_matrix</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">transformation</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/function_list.html">function_list</a></span><span class="op">(</span><span class="st">"v1"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,</span>
<span>                                        <span class="st">"v1*2"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="fl">2</span>, </span>
<span>                                        check.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_design</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/simdesign_mvtnorm.html">simdesign_mvtnorm</a></span><span class="op">(</span></span>
<span>  relations <span class="op">=</span> <span class="va">correlation_matrix</span>,        </span>
<span>  transform_initial <span class="op">=</span> <span class="va">transformation</span>, </span>
<span>  prefix_final <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ignoring the collinearity</span></span>
<span><span class="va">sim_data</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/simulate_data.html">simulate_data</a></span><span class="op">(</span><span class="va">sim_design</span>, n_obs <span class="op">=</span> <span class="fl">100</span>, seed <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">sim_data</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">v1</th>
<th align="right">v1*2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">v1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">v1*2</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># rejecting collinear matrices</span></span>
<span><span class="va">sim_data</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/simulate_data_conditional.html">simulate_data_conditional</a></span><span class="op">(</span><span class="va">sim_design</span>,</span>
<span>                                              n_obs <span class="op">=</span> <span class="fl">100</span>, seed <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                                              reject <span class="op">=</span> <span class="va">is_collinear</span>,</span>
<span>                                              reject_max_iter <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                                              return_tries <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in reject(x): is_collinear: Matrix is not full rank.</span></span>
<span></span>
<span><span class="co">## Warning in reject(x): is_collinear: Matrix is not full rank.</span></span>
<span></span>
<span><span class="co">## Warning in reject(x): is_collinear: Matrix is not full rank.</span></span></code></pre>
<pre><code><span><span class="co">## Warning in simdata::simulate_data_conditional(sim_design, n_obs = 100, seed = 2, : No suitable datamatrix found within iteration limit. Returning NULL.</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_data</span></span></code></pre></div>
<pre><code><span><span class="co">## $x</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $n_tries</span></span>
<span><span class="co">## [1] 3</span></span></code></pre>
<p>Note that multiple conditions can be checked by passing a
<code>function_list</code> as rejection function. All of them must be
fulfilled or the matrix is rejected.</p>
<p>In our example below we randomly transform the columns to be
collinear or constant. However, in the end we obtain a result which
passes both checks.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">correlation_matrix</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">transformation</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/function_list.html">function_list</a></span><span class="op">(</span></span>
<span>  <span class="st">"v1"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,</span>
<span>  <span class="st">"might_be_collinear"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span>, </span>
<span>  <span class="st">"might_be_constant"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  check.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_design</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/simdesign_mvtnorm.html">simdesign_mvtnorm</a></span><span class="op">(</span></span>
<span>  relations <span class="op">=</span> <span class="va">correlation_matrix</span>,        </span>
<span>  transform_initial <span class="op">=</span> <span class="va">transformation</span>,</span>
<span>  prefix_final <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_data</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/simulate_data_conditional.html">simulate_data_conditional</a></span><span class="op">(</span></span>
<span>  <span class="va">sim_design</span>,</span>
<span>  n_obs <span class="op">=</span> <span class="fl">100</span>, seed <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  reject <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/function_list.html">function_list</a></span><span class="op">(</span><span class="va">is_collinear</span>, </span>
<span>                                  <span class="va">contains_constant</span><span class="op">)</span>,</span>
<span>  reject_max_iter <span class="op">=</span> <span class="fl">3</span>, </span>
<span>  return_tries <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in f(x): is_collinear: Matrix is not full rank.</span></span></code></pre>
<pre><code><span><span class="co">## Warning in f(x): contains_constant: Matrix contains constant column.</span></span></code></pre>
<pre><code><span><span class="co">## Warning in f(x): is_collinear: Matrix is not full rank.</span></span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Number of tries: %d"</span>, <span class="va">sim_data</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Number of tries: 3"</span></span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sim_data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">v1</th>
<th align="right">might_be_collinear</th>
<th align="right">might_be_constant</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">-1.5696270</td>
<td align="right">1.4666759</td>
<td align="right">-1.4960854</td>
</tr>
<tr class="even">
<td align="right">-1.1502890</td>
<td align="right">-2.0230091</td>
<td align="right">-0.6816524</td>
</tr>
<tr class="odd">
<td align="right">0.5070104</td>
<td align="right">0.7471119</td>
<td align="right">0.1759890</td>
</tr>
<tr class="even">
<td align="right">-0.4375236</td>
<td align="right">0.9427262</td>
<td align="right">0.8910450</td>
</tr>
<tr class="odd">
<td align="right">-1.6917860</td>
<td align="right">-0.7121474</td>
<td align="right">-0.3322689</td>
</tr>
<tr class="even">
<td align="right">0.9830335</td>
<td align="right">-0.9880418</td>
<td align="right">0.2655464</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="user-defined-simdesign-classes">User defined <code>simdesign</code> classes<a class="anchor" aria-label="anchor" href="#user-defined-simdesign-classes"></a>
</h3>
<div class="section level4">
<h4 id="other">Other initial distributions<a class="anchor" aria-label="anchor" href="#other"></a>
</h4>
<p>In this package, simulating initial data from a multivariate Normal
distribution is already implemented in the
<code>simdesign_mvtnorm</code> S3 class. However, it is easy to
implement other distributions and extend the underlying interface of the
<code>simdesign</code> class. To do this, all that needs to be
implemented is the <code>generator</code> object of the new simulation
class. Below we show how to code a toy wrapper to simulate binary data
using the <code><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">stats::rbinom</a></code> function.</p>
<ul>
<li>A new class must implement a <code>generator</code> function which
takes one argument (number of observations to simulate) and outputs a
two-dimensional array (matrix or data.frame)</li>
<li>A new class should always use <code>...</code> to pass further
arguments to <code>simdesign</code>
</li>
<li>A new class should extend the class attribute to facilitate writing
S3 methods which recognize the newly implemented class</li>
</ul>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">binomial_simdesign</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">size</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">prob</span> <span class="op">=</span> <span class="fl">0.5</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># define generator function</span></span>
<span>  <span class="co"># make sure it returns a two-dimensional array</span></span>
<span>  <span class="va">generator</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, size <span class="op">=</span> <span class="va">size</span>, prob <span class="op">=</span> <span class="va">prob</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># setup simdesign object</span></span>
<span>  <span class="co"># make sure to pass generator function and ...</span></span>
<span>  <span class="co"># all other information passed is optional</span></span>
<span>  <span class="va">dsgn</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/simdesign.html">simdesign</a></span><span class="op">(</span></span>
<span>    generator <span class="op">=</span> <span class="va">generator</span>, </span>
<span>    size <span class="op">=</span> <span class="va">size</span>, </span>
<span>    prob <span class="op">=</span> <span class="va">prob</span>,</span>
<span>    <span class="va">...</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># extend the class attribute </span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">dsgn</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"binomial_simdesign"</span>, <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">dsgn</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># return the object</span></span>
<span>  <span class="va">dsgn</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Finally, we can use the newly created class as in the examples
before.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_design</span> <span class="op">=</span> <span class="fu">binomial_simdesign</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span>
<span><span class="va">sim_data</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/simulate_data.html">simulate_data</a></span><span class="op">(</span><span class="va">sim_design</span>, <span class="fl">100</span>, seed <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">sim_data</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">sim_data</th>
<th align="right">Freq</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">0</td>
<td align="right">32</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="right">68</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="using-real-data">Using real data<a class="anchor" aria-label="anchor" href="#using-real-data"></a>
</h4>
<p>The package can also be easily extended to be used as wrapper for
resampling real datasets. Similar to the <a href="#other">example
above</a>, this is easily accomplished by extending the
<code>simdesign</code> class as shown below. Here we implement a simple
bootstrap procedure by sampling randomly with replacement from the
dataset. Many other resampling techniques could be created
similarly.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">realdata_simdesign</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dataset</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># define generator function</span></span>
<span>  <span class="co"># make sure it returns a two-dimensional array</span></span>
<span>  <span class="va">generator</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="va">dataset</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, ,</span>
<span>                                  drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># setup simdesign object</span></span>
<span>  <span class="co"># make sure to pass generator function and ...</span></span>
<span>  <span class="co"># all other information passed is optional</span></span>
<span>  <span class="va">dsgn</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/simdesign.html">simdesign</a></span><span class="op">(</span></span>
<span>    generator <span class="op">=</span> <span class="va">generator</span>, </span>
<span>    dataset <span class="op">=</span> <span class="va">dataset</span>,</span>
<span>    <span class="va">...</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># extend the class attribute </span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">dsgn</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"realdata_simdesign"</span>, <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">dsgn</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># return the object</span></span>
<span>  <span class="va">dsgn</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Note that this works because the dataset is saved to the environment
of the generator function and therefore always accessible to the
generator function. It can be retrieved via
<code>get("dataset", envir = environment(sim_design$generator))</code>.</p>
<p>Finally, we can use the newly created class as in the examples
before.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span>
<span><span class="va">sim_design</span> <span class="op">=</span> <span class="fu">realdata_simdesign</span><span class="op">(</span><span class="va">iris</span>, prefix_final <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="va">sim_data</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/simulate_data.html">simulate_data</a></span><span class="op">(</span><span class="va">sim_design</span>, <span class="fl">100</span>, seed <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sim_data</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">Sepal.Length</th>
<th align="right">Sepal.Width</th>
<th align="right">Petal.Length</th>
<th align="right">Petal.Width</th>
<th align="left">Species</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">68</td>
<td align="right">5.8</td>
<td align="right">2.7</td>
<td align="right">4.1</td>
<td align="right">1.0</td>
<td align="left">versicolor</td>
</tr>
<tr class="even">
<td align="left">129</td>
<td align="right">6.4</td>
<td align="right">2.8</td>
<td align="right">5.6</td>
<td align="right">2.1</td>
<td align="left">virginica</td>
</tr>
<tr class="odd">
<td align="left">43</td>
<td align="right">4.4</td>
<td align="right">3.2</td>
<td align="right">1.3</td>
<td align="right">0.2</td>
<td align="left">setosa</td>
</tr>
<tr class="even">
<td align="left">14</td>
<td align="right">4.3</td>
<td align="right">3.0</td>
<td align="right">1.1</td>
<td align="right">0.1</td>
<td align="left">setosa</td>
</tr>
<tr class="odd">
<td align="left">51</td>
<td align="right">7.0</td>
<td align="right">3.2</td>
<td align="right">4.7</td>
<td align="right">1.4</td>
<td align="left">versicolor</td>
</tr>
<tr class="even">
<td align="left">85</td>
<td align="right">5.4</td>
<td align="right">3.0</td>
<td align="right">4.5</td>
<td align="right">1.5</td>
<td align="left">versicolor</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level3">
<h3 id="aspects-of-high-dimensional-setups">Aspects of high-dimensional setups<a class="anchor" aria-label="anchor" href="#aspects-of-high-dimensional-setups"></a>
</h3>
<p>In high-dimensional simulation studies the number of simulated
variables is large. We briefly demonstrate how to simulate 100 variables
from a multivariate Normal distribution with block correlation matrix.
This shows how to use the package functionality programmatically.</p>
<ul>
<li>Create a block diagonal matrix easily using
<code><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">base::expand.grid</a></code> and <code>cor_from_upper</code>
<ul>
<li>Note that for 1000s of variables drawing from a single multivariate
Normal distribution using <code><a href="https://rdrr.io/pkg/mvtnorm/man/Mvnorm.html" class="external-link">mvtnorm::rmvnorm</a></code> is highly
inefficient and could be replaced by drawing from individual blocks of
multivariate Normal distributions of smaller dimension</li>
</ul>
</li>
<li>Transform the variables blockwise by creating a
<code>function_list</code> from a list of functions via
<code>as_function_list</code>
<ul>
<li>Note the use of <code><a href="https://rdrr.io/r/base/substitute.html" class="external-link">base::substitute</a></code> to construct functions
programmatically (<code>substitute</code> actually substitutes the
passed value for <code>i</code> instead of the symbol <code>i</code> in
the function definition)</li>
<li>Note that the final transformation is applied to a whole submatrix
at once (this is possible as long as the resulting outputs have equal
number of rows)</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">correlation_matrix</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/cor_from_upper.html">cor_from_upper</a></span><span class="op">(</span></span>
<span>  <span class="fl">100</span>,</span>
<span>  entries <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">30</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">30</span>, <span class="fl">0.5</span><span class="op">)</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span><span class="fl">31</span><span class="op">:</span><span class="fl">50</span>, <span class="fl">31</span><span class="op">:</span><span class="fl">50</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create list of transformation functions programmatically</span></span>
<span><span class="co"># For the first 60 variables: </span></span>
<span><span class="co"># odd varibles will be translated</span></span>
<span><span class="co"># even variables will be scaled</span></span>
<span><span class="va">transformation</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">60</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">i</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">transformation</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span> <span class="op">*</span> <span class="fl">5</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>i <span class="op">=</span> <span class="va">i</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="va">transformation</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span> <span class="op">-</span> <span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>i <span class="op">=</span> <span class="va">i</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># the remaining are returned as they are</span></span>
<span><span class="va">transformation</span><span class="op">[[</span><span class="fl">61</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span>, <span class="fl">61</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span></span>
<span><span class="co"># construct single transformation function from the list</span></span>
<span><span class="va">transformation</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/as_function_list.html">as_function_list</a></span><span class="op">(</span><span class="va">transformation</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create simulation design</span></span>
<span><span class="va">sim_design</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/simdesign_mvtnorm.html">simdesign_mvtnorm</a></span><span class="op">(</span></span>
<span>  relations <span class="op">=</span> <span class="va">correlation_matrix</span>, </span>
<span>  transform_initial <span class="op">=</span> <span class="va">transformation</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can visualise the correlation matrix as before using
<code>ggplot2</code>.</p>
<p><img src="Demo_files/figure-html/unnamed-chunk-25-1.png" width="700"></p>
<p>A correlation network can often be used to clearly display such large
correlation structures. To keep the network simple, we remove vertex and
edge labels and adjust vertex and edge sizes.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_cor_network.html">plot_cor_network</a></span><span class="op">(</span><span class="va">sim_design</span>, seed <span class="op">=</span> <span class="fl">2</span>,  </span>
<span>                          vertex_labels <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>                          edge_label_function <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                          edge_width_function <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fl">0.01</span>,</span>
<span>                          edge_weight_function <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fl">0.25</span> <span class="op">*</span> <span class="va">x</span>, </span>
<span>                          use_edge_weights <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                          edge.color <span class="op">=</span> <span class="st">"clipped-ramp"</span>, </span>
<span>                          vertex.size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="Demo_files/figure-html/unnamed-chunk-26-1.png" width="700"></p>
<p>The simulated data is subsequently obtained by applying the specified
transformations to the initial multivariate Normal data. It is
visualised below by means of density curves for each variable (for
brevity the legend is not displayed and variables are indicated by
different colors).</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_data</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/simulate_data.html">simulate_data</a></span><span class="op">(</span><span class="va">sim_design</span>, n_obs <span class="op">=</span> <span class="fl">50</span>, seed <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p><img src="Demo_files/figure-html/unnamed-chunk-28-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="parallel">Parallelization<a class="anchor" aria-label="anchor" href="#parallel"></a>
</h3>
<p>This example briefly shows how to use the package together with
parallelization via clusters to speed up simulations. On Unix-based
systems, forking provides an alternative method to parallelize code,
which results in even simpler code than the one below. We use the same
setup as in <a href="#ex2">Example 2</a>. The following code is not run
to ensure that the vignette builds on any system, but can be used as is
on any system that has the <code>simdata</code> package installed.</p>
<ul>
<li>We set up a local cluster using 2 CPU threads via the
<code>parallel</code> and <code>doParallel</code> packages
<ul>
<li>Alternative parallel implementations such as <code>future</code> can
be used.</li>
</ul>
</li>
<li>Note that the random seed is now set via the options of
<code>doRNG</code> in the head of the <code>foreach</code> loop (and NOT
within the call of <code>simulate_data</code>).</li>
<li>Note that the <code>simdata</code> package needs to be explicitly
passed to the <code>foreach</code> loop such that every thread has
access to the library. This is Windows specific, on Unix-based systems
this is not necessary as forking automatically makes the library
available to all child processes.</li>
<li>Note that the global variable <code>sim_design</code> is passed to
the threads automatically, but this can be forced via the
<code>.export</code> argument in the <code>foreach</code> loop</li>
<li>The results are stored in a list.</li>
</ul>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">correlation_matrix</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1</span>, nrow <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">transformation</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/function_list.html">function_list</a></span><span class="op">(</span></span>
<span>    <span class="st">"v1"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,</span>
<span>    <span class="st">"v2*2"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="fl">2</span>, </span>
<span>    <span class="st">"v3^2"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span>,</span>
<span>    <span class="st">"v4+v5"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span>, <span class="fl">4</span><span class="op">]</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span>, <span class="fl">5</span><span class="op">]</span>, </span>
<span>    check.names <span class="op">=</span> <span class="cn">FALSE</span> <span class="co"># pass columnnames exactly as specified here</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">sim_design</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/simdesign_mvtnorm.html">simdesign_mvtnorm</a></span><span class="op">(</span></span>
<span>  relations <span class="op">=</span> <span class="va">correlation_matrix</span>,</span>
<span>  transform_initial <span class="op">=</span> <span class="va">transformation</span>, </span>
<span>  prefix_final <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># parallelisation</span></span>
<span><span class="va">cl</span> <span class="op">=</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu">doParallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html" class="external-link">registerDoParallel</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">=</span> <span class="fu">foreach</span><span class="op">(</span></span>
<span>  i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, </span>
<span>  .packages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"simdata"</span><span class="op">)</span>,</span>
<span>  .options.RNG <span class="op">=</span> <span class="fl">1</span> <span class="co"># note that the seed is passed here</span></span>
<span><span class="op">)</span> <span class="op">%dorng%</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/simulate_data.html">simulate_data</a></span><span class="op">(</span><span class="va">sim_design</span>, n_obs <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># do some task with the simulated data</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">stopCluster</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">res</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, <span class="va">summary</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="partial-functions">Partial functions<a class="anchor" aria-label="anchor" href="#partial-functions"></a>
</h3>
<p>The <code>simdata</code> packages makes heavy use of function objects
to define simulation designs (e.g. also NORTA based simulation).
Sometimes it may be necessary to fix parameters of such functions, or
define them via code. In <a href="ex2">Example 2</a> we created a
variable <code>v2*2</code> by multiplying the initial data times 2.</p>
<p>What if we wanted to parametrize this? If we simply use a global
variable this will have undesirable consequences, as R may change the
value of the global value at any time (or remove the value, which leads
to a failure of the sampling procedure).</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># parameter</span></span>
<span><span class="va">mult</span> <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="va">transformation</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/function_list.html">function_list</a></span><span class="op">(</span></span>
<span>  <span class="st">"v1"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">mult</span> <span class="co"># dangerous, depends on global variable!</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_design</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/simdesign_mvtnorm.html">simdesign_mvtnorm</a></span><span class="op">(</span></span>
<span>        relations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, </span>
<span>        transform_initial <span class="op">=</span> <span class="va">transformation</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sample1</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/simulate_data.html">simulate_data</a></span><span class="op">(</span><span class="va">sim_design</span>, n_obs <span class="op">=</span> <span class="fl">5</span>, seed <span class="op">=</span> <span class="fl">25897165</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># change value of global variable</span></span>
<span><span class="va">mult</span> <span class="op">=</span> <span class="fl">4</span></span>
<span><span class="va">sample2</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/simulate_data.html">simulate_data</a></span><span class="op">(</span><span class="va">sim_design</span>, n_obs <span class="op">=</span> <span class="fl">5</span>, seed <span class="op">=</span> <span class="fl">25897165</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># note the different values in both columns</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">sample1</span>, <span class="va">sample2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">v1</th>
<th align="right">v1</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">-0.8166563</td>
<td align="right">-1.633312</td>
</tr>
<tr class="even">
<td align="right">2.6989619</td>
<td align="right">5.397924</td>
</tr>
<tr class="odd">
<td align="right">1.2366453</td>
<td align="right">2.473291</td>
</tr>
<tr class="even">
<td align="right">-1.1770835</td>
<td align="right">-2.354167</td>
</tr>
<tr class="odd">
<td align="right">1.9821340</td>
<td align="right">3.964268</td>
</tr>
</tbody>
</table>
<p>This can be avoided by the use of <code><a href="../reference/partial.html">simdata::partial</a></code>. This
requires to specify the transformation as function in two parameters, of
which one is fixed.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># parameter</span></span>
<span><span class="va">mult</span> <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="va">transformation</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/function_list.html">function_list</a></span><span class="op">(</span></span>
<span>    <span class="co"># specify function as partial </span></span>
<span>    <span class="st">"v1"</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/partial.html">partial</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">mult</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">mult</span>, mult <span class="op">=</span> <span class="va">mult</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_design</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/simdesign_mvtnorm.html">simdesign_mvtnorm</a></span><span class="op">(</span></span>
<span>        relations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, </span>
<span>        transform_initial <span class="op">=</span> <span class="va">transformation</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sample1</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/simulate_data.html">simulate_data</a></span><span class="op">(</span><span class="va">sim_design</span>, n_obs <span class="op">=</span> <span class="fl">5</span>, seed <span class="op">=</span> <span class="fl">25897165</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># change value of global variable</span></span>
<span><span class="va">mult</span> <span class="op">=</span> <span class="fl">4</span></span>
<span><span class="va">sample2</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/simulate_data.html">simulate_data</a></span><span class="op">(</span><span class="va">sim_design</span>, n_obs <span class="op">=</span> <span class="fl">5</span>, seed <span class="op">=</span> <span class="fl">25897165</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># note both columns are equal now, as expected</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">sample1</span>, <span class="va">sample2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">v1</th>
<th align="right">v1</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">-0.8166563</td>
<td align="right">-0.8166563</td>
</tr>
<tr class="even">
<td align="right">2.6989619</td>
<td align="right">2.6989619</td>
</tr>
<tr class="odd">
<td align="right">1.2366453</td>
<td align="right">1.2366453</td>
</tr>
<tr class="even">
<td align="right">-1.1770835</td>
<td align="right">-1.1770835</td>
</tr>
<tr class="odd">
<td align="right">1.9821340</td>
<td align="right">1.9821340</td>
</tr>
</tbody>
</table>
<p><code><a href="../reference/partial.html">simdata::partial</a></code> can be used to fix an arbitrary number
of parameters, and may also help if a transformation is defined inside
another function (as the parameter set inside a function may not be
available outside).</p>
</div>
</div>
<div class="section level2">
<h2 id="rsession">R session information<a class="anchor" aria-label="anchor" href="#rsession"></a>
</h2>
<pre><code><span><span class="co">## R version 4.3.1 (2023-06-16)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu (64-bit)</span></span>
<span><span class="co">## Running under: Ubuntu 22.04.3 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">##  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">## [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: UTC</span></span>
<span><span class="co">## tzcode source: system (glibc)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] parallel  stats     graphics  grDevices utils     datasets  methods  </span></span>
<span><span class="co">## [8] base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">##  [1] doRNG_1.8.6        rngtools_1.5.2     doParallel_1.0.17  iterators_1.0.14  </span></span>
<span><span class="co">##  [5] foreach_1.5.2      knitr_1.43         GGally_2.1.2       reshape2_1.4.4    </span></span>
<span><span class="co">##  [9] ggplot2_3.4.3      simdata_0.3.0.9003</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] sass_0.4.7         utf8_1.2.3         generics_0.1.3     stringi_1.7.12    </span></span>
<span><span class="co">##  [5] digest_0.6.33      magrittr_2.0.3     evaluate_0.21      grid_4.3.1        </span></span>
<span><span class="co">##  [9] RColorBrewer_1.1-3 mvtnorm_1.2-3      fastmap_1.1.1      rprojroot_2.0.3   </span></span>
<span><span class="co">## [13] plyr_1.8.8         jsonlite_1.8.7     reshape_0.8.9      purrr_1.0.2       </span></span>
<span><span class="co">## [17] fansi_1.0.4        viridisLite_0.4.2  scales_1.2.1       codetools_0.2-19  </span></span>
<span><span class="co">## [21] textshaping_0.3.6  jquerylib_0.1.4    cli_3.6.1          rlang_1.1.1       </span></span>
<span><span class="co">## [25] munsell_0.5.0      withr_2.5.0        cachem_1.0.8       yaml_2.3.7        </span></span>
<span><span class="co">## [29] tools_4.3.1        memoise_2.0.1      dplyr_1.1.2        colorspace_2.1-0  </span></span>
<span><span class="co">## [33] vctrs_0.6.3        R6_2.5.1           lifecycle_1.0.3    stringr_1.5.0     </span></span>
<span><span class="co">## [37] fs_1.6.3           ragg_1.2.5         pkgconfig_2.0.3    desc_1.4.2        </span></span>
<span><span class="co">## [41] pkgdown_2.0.7      pillar_1.9.0       bslib_0.5.1        gtable_0.3.4      </span></span>
<span><span class="co">## [45] glue_1.6.2         Rcpp_1.0.11        systemfonts_1.0.4  highr_0.10        </span></span>
<span><span class="co">## [49] xfun_0.40          tibble_3.2.1       tidyselect_1.2.0   farver_2.1.1      </span></span>
<span><span class="co">## [53] igraph_1.5.1       htmltools_0.5.6    labeling_0.4.2     rmarkdown_2.24    </span></span>
<span><span class="co">## [57] compiler_4.3.1</span></span></code></pre>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-BinderSetup" class="csl-entry">
Binder, Harald, Willi Sauerbrei, and Patrick Royston. 2011.
<span>“Multivariable Model-Building with Continous Covariates: 1.
Performance Measures and Simulation Design.”</span> Report.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Michael Kammer.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
