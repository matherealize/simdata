<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>simdata: NORTA based simulation designs • simdata</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="simdata: NORTA based simulation designs">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">simdata</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Demo.html">simdata: A package for creating simulated datasets</a></li>
    <li><a class="dropdown-item" href="../articles/NORTA_demo.html">simdata: NORTA based simulation designs</a></li>
    <li><a class="dropdown-item" href="../articles/Technical_documentation.html">simdata: Technical documentation</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/matherealize/simdata/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>simdata: NORTA based simulation designs</h1>
                        <h4 data-toc-skip class="author">Michael
Kammer</h4>
            
            <h4 data-toc-skip class="date">2024-12-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/matherealize/simdata/blob/main/vignettes/NORTA_demo.Rmd" class="external-link"><code>vignettes/NORTA_demo.Rmd</code></a></small>
      <div class="d-none name"><code>NORTA_demo.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This document describes the workflow to define NORmal-To-Anything
(NORTA) based simulation designs using the <code>simdata</code> package.
The method is very useful to re-create existing datasets through a
parametric approximation for usage in simulation studies. It is also
quite easy to use, and allows the definition of presets for sharing
simulation setups. General details of the methodology and further
references are given in e.g.  <span class="citation">Cario and Nelson
(1997)</span> and <span class="citation">Ghosh and Henderson
(2003)</span>.</p>
<p>In this vignette we will prefix all relevant function calls by
<code>::</code> to show the package which implements the function - this
is not necessary but only done for demonstration purposes.</p>
<div class="section level3">
<h3 id="outline">Outline of NORTA<a class="anchor" aria-label="anchor" href="#outline"></a>
</h3>
<p>The goal of the NORTA procedure is to produce identically
independently distributed (iid) samples from random variables with a
given correlation structure (Pearson correlation matrix) and given
marginal distributions, thereby e.g. approximating existing
datasets.</p>
<p>Following <span class="citation">Ghosh and Henderson (2003)</span>,
we want to sample iid replicates of the random vector
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mn>1</mn></msub><mo>,</mo><msub><mi>X</mi><mn>2</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>X</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">X = (X_1, X_2, \ldots, X_k)</annotation></semantics></math>.
Denote by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo>≤</mo><mi>s</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">F_i(s) = P(X_i \leq s)</annotation></semantics></math>
the distribution functions (i.e. the marginal distributions) of the
components of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>,
and by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Σ</mi><mi>X</mi></msub><annotation encoding="application/x-tex">\Sigma_X</annotation></semantics></math>
the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>×</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">k \times k</annotation></semantics></math>
correlation matrix of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>.
Then NORTA proceeds as follows:</p>
<ul>
<li>Generate multivariate standard normal random vectors (i.e mean 0,
variance 1)
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Z</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Z</mi><mn>1</mn></msub><mo>,</mo><msub><mi>Z</mi><mn>2</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>Z</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Z = (Z_1, Z_2, \ldots, Z_k)</annotation></semantics></math>
with a correlation matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Σ</mi><mi>Z</mi></msub><annotation encoding="application/x-tex">\Sigma_Z</annotation></semantics></math>.</li>
<li>Compute the random vector
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
via
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mi>i</mi></msub><mo>:=</mo><msubsup><mi>F</mi><mi>i</mi><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>Φ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Z</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">X_i := F_i^{-1}(\Phi(Z_i))</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Φ</mi><annotation encoding="application/x-tex">\Phi</annotation></semantics></math>
denotes the distribution function of the standard normal distribution,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>F</mi><mi>i</mi><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>:=</mo><mo>inf</mo><mo stretchy="false" form="prefix">{</mo><mi>x</mi><mo>:</mo><msub><mi>F</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>≥</mo><mi>t</mi><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">F_i^{-1}(t) := \inf\{x: F_i(x) \geq t\}</annotation></semantics></math>
is the quantile function of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mi>i</mi></msub><annotation encoding="application/x-tex">X_i</annotation></semantics></math>.</li>
</ul>
<p>The resulting vector
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
then has the desired marginal distribution. To obtain the target
correlation structure
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Σ</mi><mi>X</mi></msub><annotation encoding="application/x-tex">\Sigma_X</annotation></semantics></math>,
the correlation matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Σ</mi><mi>Z</mi></msub><annotation encoding="application/x-tex">\Sigma_Z</annotation></semantics></math>
for the first step has to be chosen appropriately. This can be achieved
via solving univariable optimisation problems for each pair of variables
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mi>i</mi></msub><annotation encoding="application/x-tex">X_i</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mi>j</mi></msub><annotation encoding="application/x-tex">X_j</annotation></semantics></math>
in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
and is part of the <code>simdata</code> package.</p>
</div>
<div class="section level3">
<h3 id="caveats-of-norta">Caveats of NORTA<a class="anchor" aria-label="anchor" href="#caveats-of-norta"></a>
</h3>
<p>The NORTA procedure has some known limitations, which may lead to
discrepancies between the target correlation structure and the
correlation structure obtained from the sampling process. These are,
however, partly alleviated when using existing datasets as templates, or
by special techniques within <code>simdata</code>.</p>
<ul>
<li>Not all combinations of given marginal distributions and target
correlation are feasible by the nature of the variables. This is not an
issue when an existing dataset is used as template, since that
demonstrates that the combination exists.</li>
<li>The optimisation procedure to obtain
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Σ</mi><mi>Z</mi></msub><annotation encoding="application/x-tex">\Sigma_Z</annotation></semantics></math>
may lead to a matrix which is not positive definite (since the
optimisation is only done for pairs of variables), and therefore not a
proper correlation matrix. To alleviate this, the <code>simdata</code>
package ensures positive definiteness by using the closest positive
definite matrix instead. This may lead to discrepancies between the
target correlation and the achieved correlation structure.</li>
<li>NORTA cannot reproduce non-linear relationships between variables.
This may lead to issues for continuous variables and categorical
variables with more than two categories when the goal is to faithfully
re-create a real dataset that features non-linear relations.</li>
<li>The optimisation procedure to obtain
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Σ</mi><mi>Z</mi></msub><annotation encoding="application/x-tex">\Sigma_Z</annotation></semantics></math>
may take a while to compute when the number of variables increases. This
is alleviated through the fact that this computation has to be done only
a single time, during definition of the simulation design. All further
simulation iterations only use the optimisation result and are therefore
not subject to this issue.</li>
<li>When applied to an existing dataset, NORTA relies on the estimation
of the target correlation matrix and marginal distributions. More
complex data (e.g. special marginal distributions, complex correlation
structure) therefore requires more observations for an accurate
representation.</li>
</ul>
</div>
<div class="section level3">
<h3 id="comparison-to-other-methods">Comparison to other methods<a class="anchor" aria-label="anchor" href="#comparison-to-other-methods"></a>
</h3>
<p>NORTA is well suited to re-create existing datasets through an
explicit parametric approximation. Similar methods exist, that achieve
this through other means. A particularly interesting alternative is the
generation of synthetic datasets using an approach closely related to
multiple imputation, and is implemented in e.g. the
<code>synthpop</code> R package (<span class="citation">Nowok, Raab, and
Dibben (2016)</span>). Its’ primary aim is to achieve confidentiality by
re-creating copies to be shared for existing, sensitive datasets.</p>
<p>In comparison, <code>synthpop</code> potentially offers more flexible
data generation than NORTA, thereby leading to a better approximation of
an original dataset. However, <code>synthpop</code> is also more opaque
than the explicit, user defined specification of correlation and
marginal distributions of NORTA. This also entails that
<code>synthpop</code> can be generally used more like a black-box
approach, which requires little user input, but is also less transparent
than the manual curation of the simulation setup in NORTA. Furthermore,
NORTA allows easy changes to the design to obtain a wide variety of
study designs from a single template dataset, whereas
<code>synthpop</code> is more targeted at re-creating the original
dataset. Both methods therefore have their distinct usecases and
complement each other.</p>
</div>
</div>
<div class="section level2">
<h2 id="workflow-in-simdata">Workflow in <code>simdata</code><a class="anchor" aria-label="anchor" href="#workflow-in-simdata"></a>
</h2>
<p>Given the <a href="#outline">outline of the method</a>, all the user
has to specify to define a NORTA design on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
variables are</p>
<ul>
<li>A
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>×</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">k \times k</annotation></semantics></math>
target correlation matrix</li>
<li>The
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
marginal distributions for each variable, given as quantile
functions</li>
</ul>
<p>These can be estimated from existing datasets of interest.
<code>simdata</code> offers a helper function to automate this process,
but the user can also specify the required input manually. We
demonstrate both use cases in the <a href="#example">example
below</a>.</p>
<div class="section level3">
<h3 id="quantile-functions-for-some-common-distributions">Quantile functions for some common distributions<a class="anchor" aria-label="anchor" href="#quantile-functions-for-some-common-distributions"></a>
</h3>
<p>The required marginal distributions are given as quantile functions.
R provides implementations of many standard distributions which can be
directly used, see the help on <code>distributions</code>. The quantile
functions use the prefix “q”, as in e.g. <code>qnorm</code> or
<code>qbinom</code>. Further implementations can be found in the
packages <code>extraDistr</code>, <code>actuar</code> and many others
(see <a href="https://CRAN.R-project.org/view=Distributions" class="external-link uri">https://CRAN.R-project.org/view=Distributions</a>).</p>
</div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>In this example we will setup a NORTA based simulation design for a
dataset extracted from the National Health And Nutrition Examination
Survey (NHANES), accessible in R via several packages (we use the
<code>NHANES</code> package in this demo).</p>
<div class="section level3">
<h3 id="load-dataset">Load dataset<a class="anchor" aria-label="anchor" href="#load-dataset"></a>
</h3>
<p>First we will load the dataset and extract several variables of
interest, namely gender (‘Gender’), age (‘Age’), race (‘Race’), weight
(‘Weight’), bmi (‘BMI’), systolic (‘BPsys’) and diastolic blood pressure
(‘BPdia’). These variabes demonstrate several different kinds of
distributions. For a detailed description of the data, please see the
documentation at <a href="https://www.cdc.gov/nchs/nhanes.htm" class="external-link uri">https://www.cdc.gov/nchs/nhanes.htm</a> and for the
<code>NHANES</code> R package on CRAN. Here we are not concerned with
the exact codings of the variables, so we will remove labels to factor
variables and work with numeric codes. Further, we will only use data
from a single survey round to keep the dataset small.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">NHANES</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">=</span> <span class="va">NHANES</span> <span class="op">%&gt;%</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">SurveyYr</span> <span class="op">==</span> <span class="st">"2011_12"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">select</span><span class="op">(</span><span class="va">Gender</span>, <span class="va">Age</span>, Race <span class="op">=</span> <span class="va">Race1</span>, <span class="va">Weight</span>, </span>
<span>           <span class="va">BMI</span>, BPsys <span class="op">=</span> <span class="va">BPSys1</span>, BPdia <span class="op">=</span> <span class="va">BPDia1</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Age</span> <span class="op">&gt;</span> <span class="fl">18</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>    <span class="fu">mutate</span><span class="op">(</span>Gender <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">Gender</span> <span class="op">==</span> <span class="st">"male"</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, </span>
<span>           Race <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">Race</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">##   Gender   Age  Race Weight   BMI BPsys BPdia</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>      2    43     1   98.6  33.3   100    70</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>      1    80     4   85.9  28.5   124    72</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>      1    35     4   89    27.9   108    62</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>      1    57     4   96.9  28     112    70</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>      1    57     4   96.9  28     112    70</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>      1    57     4   96.9  28     112    70</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="estimate-target-correlation">Estimate target correlation<a class="anchor" aria-label="anchor" href="#estimate-target-correlation"></a>
</h3>
<p>Using this dataset, we first define the target correlation
<code>cor_target</code> and plot it.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cor_target</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="fu">ggcorrplot</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggcorrplot/man/ggcorrplot.html" class="external-link">ggcorrplot</a></span><span class="op">(</span><span class="va">cor_target</span>, lab <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="NORTA_demo_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="define-marginal-distributions">Define marginal distributions<a class="anchor" aria-label="anchor" href="#define-marginal-distributions"></a>
</h3>
<p>Further, we define a list of marginal distributions <code>dist</code>
representing the individual variables. Each entry of the list must be a
function in one argument, defining the quantile function of the
variable. The order of the entries must correspond to the order in the
target correlation <code>cor_target</code>.</p>
<div class="section level4">
<h4 id="automatically">Automatically<a class="anchor" aria-label="anchor" href="#automatically"></a>
</h4>
<p><code>simdata</code> offers the helper function
<code><a href="../reference/quantile_functions_from_data.html">simdata::quantile_functions_from_data()</a></code> to automate
estimation of quantile functions from the available data. It does so
non-parametrically and implements two approaches, one more suited for
categorical data, and the other more suited to continuous data. In
practice the parameter <code>n_small</code> can be used to determine a
number of unique values required to use the latter approach, rather than
the former. See the documentation for more details.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dist_auto</span> <span class="op">=</span> <span class="fu"><a href="../reference/quantile_functions_from_data.html">quantile_functions_from_data</a></span><span class="op">(</span><span class="va">df</span>, n_small <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> </span></code></pre></div>
</div>
<div class="section level4">
<h4 id="manually">Manually<a class="anchor" aria-label="anchor" href="#manually"></a>
</h4>
<p>We use the <code><a href="https://lbbe-software.github.io/fitdistrplus/reference/fitdist.html" class="external-link">fitdistrplus::fitdist</a></code> function to find
appropriate distribution candidates and fit their parameters. Decisions
regarding the fit of a distribution can be made using e.g. the Akaike
information criterion (AIC) or Bayesian information criterion (BIC)
displayed by the summary of the fit object returned by the function (the
lower their values, the better the fit).</p>
<p>In case a parametric distribution doesn’t fit very well, we instead
make use of a density estimate and use this to define the marginal
quantile function.</p>
<ul>
<li>Gender: a binomial distribution with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>≈</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">P(2) \approx 0.5</annotation></semantics></math>.</li>
<li>Age: the distribution is not very “nice”.
<ul>
<li>We approximate it using a kernel density estimate using the
<code><a href="https://rdrr.io/r/stats/density.html" class="external-link">stats::density</a></code> function.</li>
<li>Note that the boundaries of the distribution can be more or less
smoothed with the <code>cut</code> parameter.</li>
<li>To obtain a quantile function, first we integrate the density,
normalize it, and then use <code><a href="https://rdrr.io/r/stats/approxfun.html" class="external-link">stats::approxfun</a></code> to derive a
univariable quantile function.</li>
</ul>
</li>
<li>Race: a categorical distribution with 5 categories specified by
probabilities
<ul>
<li>Frequencies of categories were identified by a simple call to
<code><a href="https://rdrr.io/r/base/table.html" class="external-link">table()</a></code> on the full dataset.</li>
<li>Can also be implemented using the categorical distribution from the
package <code>LaplacesDemon</code> implemented via
<code>qcat</code>
</li>
</ul>
</li>
<li>Weight: gamma distribution parameters estimated using
<code><a href="https://lbbe-software.github.io/fitdistrplus/reference/fitdist.html" class="external-link">fitdistrplus::fitdist</a></code>
</li>
<li>BMI and systolic blood pressure: log-normal distribution parameters
estimated using <code><a href="https://lbbe-software.github.io/fitdistrplus/reference/fitdist.html" class="external-link">fitdistrplus::fitdist</a></code>
</li>
<li>Diastolic blood pressure: normal distribution parameters estimated
using <code><a href="https://lbbe-software.github.io/fitdistrplus/reference/fitdist.html" class="external-link">fitdistrplus::fitdist</a></code> after removing zero values from
the data</li>
</ul>
<p>The code to implement these marginal distributions is shown
below.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dist</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># gender</span></span>
<span><span class="va">dist</span><span class="op">[[</span><span class="st">"Gender"</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">qbinom</a></span><span class="op">(</span><span class="va">x</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># age</span></span>
<span><span class="va">dens</span> <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">Age</span>, cut <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="co"># cut defines how to deal with boundaries</span></span>
<span><span class="co"># integrate</span></span>
<span><span class="va">int_dens</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>Age <span class="op">=</span> <span class="va">dens</span><span class="op">$</span><span class="va">x</span>, cdf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">dens</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># normalize to obtain cumulative distribution function</span></span>
<span><span class="va">int_dens</span><span class="op">[</span>, <span class="st">"cdf"</span><span class="op">]</span> <span class="op">=</span> <span class="va">int_dens</span><span class="op">[</span>, <span class="st">"cdf"</span><span class="op">]</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">int_dens</span><span class="op">[</span>, <span class="st">"cdf"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># derive quantile function</span></span>
<span><span class="co"># outside the defined domain retun minimum and maximum age, respectively</span></span>
<span><span class="va">dist</span><span class="op">[[</span><span class="st">"Age"</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html" class="external-link">approxfun</a></span><span class="op">(</span><span class="va">int_dens</span><span class="op">[</span>, <span class="st">"cdf"</span><span class="op">]</span>, <span class="va">int_dens</span><span class="op">[</span>, <span class="st">"Age"</span><span class="op">]</span>, </span>
<span>                          yleft <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">int_dens</span><span class="op">[</span>, <span class="st">"Age"</span><span class="op">]</span><span class="op">)</span>, </span>
<span>                          yright <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">int_dens</span><span class="op">[</span>, <span class="st">"Age"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># race</span></span>
<span><span class="va">dist</span><span class="op">[[</span><span class="st">"Race"</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">x</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.112</span>, <span class="fl">0.177</span>, <span class="fl">0.253</span>, <span class="fl">0.919</span>, <span class="fl">1</span><span class="op">)</span>, </span>
<span>        labels <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># weight</span></span>
<span><span class="va">fit</span> <span class="op">=</span> <span class="fu">fitdistrplus</span><span class="fu">::</span><span class="fu"><a href="https://lbbe-software.github.io/fitdistrplus/reference/fitdist.html" class="external-link">fitdist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">Weight</span><span class="op">)</span>, <span class="st">"gamma"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="va">dist</span><span class="op">[[</span><span class="st">"Weight"</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">qgamma</a></span><span class="op">(</span><span class="va">x</span>, shape <span class="op">=</span> <span class="fl">16.5031110</span>, rate <span class="op">=</span> <span class="fl">0.2015375</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># bmi</span></span>
<span><span class="va">fit</span> <span class="op">=</span> <span class="fu">fitdistrplus</span><span class="fu">::</span><span class="fu"><a href="https://lbbe-software.github.io/fitdistrplus/reference/fitdist.html" class="external-link">fitdist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">BMI</span><span class="op">)</span>, <span class="st">"lnorm"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="va">dist</span><span class="op">[[</span><span class="st">"BMI"</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">qlnorm</a></span><span class="op">(</span><span class="va">x</span>, meanlog <span class="op">=</span> <span class="fl">3.3283118</span>, sdlog <span class="op">=</span> <span class="fl">0.2153347</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># systolic blood pressure</span></span>
<span><span class="va">fit</span> <span class="op">=</span> <span class="fu">fitdistrplus</span><span class="fu">::</span><span class="fu"><a href="https://lbbe-software.github.io/fitdistrplus/reference/fitdist.html" class="external-link">fitdist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">BPsys</span><span class="op">)</span>, <span class="st">"lnorm"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="va">dist</span><span class="op">[[</span><span class="st">"BPsys"</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">qlnorm</a></span><span class="op">(</span><span class="va">x</span>, meanlog <span class="op">=</span> <span class="fl">4.796213</span>, sdlog <span class="op">=</span> <span class="fl">0.135271</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># diastolic blood pressure</span></span>
<span><span class="va">fit</span> <span class="op">=</span> <span class="fu">fitdistrplus</span><span class="fu">::</span><span class="fu"><a href="https://lbbe-software.github.io/fitdistrplus/reference/fitdist.html" class="external-link">fitdist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df</span> <span class="op">%&gt;%</span> </span>
<span>                                         <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">BPdia</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>                                         <span class="fu">pull</span><span class="op">(</span><span class="va">BPdia</span><span class="op">)</span><span class="op">)</span>, <span class="st">"norm"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="va">dist</span><span class="op">[[</span><span class="st">"BPdia"</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="va">x</span>, mean <span class="op">=</span> <span class="fl">71.75758</span>, sd <span class="op">=</span> <span class="fl">11.36352</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="what-to-use">What to use?<a class="anchor" aria-label="anchor" href="#what-to-use"></a>
</h4>
<p>Both, the automatic and the manual way to specify marginals may be
useful. The automatic way works non-parametrically which may be useful
when a real dataset should be re-created, while the manual way allows to
specify marginals parametrically which may be useful when the data is
defined from purely theoretical specifications.</p>
</div>
</div>
<div class="section level3">
<h3 id="simulate-data">Simulate data<a class="anchor" aria-label="anchor" href="#simulate-data"></a>
</h3>
<p>Now we can use <code><a href="../reference/simdesign_norta.html">simdata::simdesign_norta</a></code> to obtain
designs using both the manual and automated marginal specifications.
After that, we simulate datasets of the same size as the original data
set using <code><a href="../reference/simulate_data.html">simdata::simulate_data</a></code>, and compare the resulting
summary statistics and correlation structures.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># use automated specification</span></span>
<span><span class="va">dsgn_auto</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/simdesign_norta.html">simdesign_norta</a></span><span class="op">(</span>cor_target_final <span class="op">=</span> <span class="va">cor_target</span>, </span>
<span>                                     dist <span class="op">=</span> <span class="va">dist_auto</span>, </span>
<span>                                     transform_initial <span class="op">=</span> <span class="va">data.frame</span>,</span>
<span>                                     names_final <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dist</span><span class="op">)</span>, </span>
<span>                                     seed_initial <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">simdf_auto</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/simulate_data.html">simulate_data</a></span><span class="op">(</span><span class="va">dsgn_auto</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, seed <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># use manual specification</span></span>
<span><span class="va">dsgn</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/simdesign_norta.html">simdesign_norta</a></span><span class="op">(</span>cor_target_final <span class="op">=</span> <span class="va">cor_target</span>, </span>
<span>                                dist <span class="op">=</span> <span class="va">dist</span>, </span>
<span>                                transform_initial <span class="op">=</span> <span class="va">data.frame</span>,</span>
<span>                                names_final <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dist</span><span class="op">)</span>, </span>
<span>                                seed_initial <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">simdf</span> <span class="op">=</span> <span class="fu">simdata</span><span class="fu">::</span><span class="fu"><a href="../reference/simulate_data.html">simulate_data</a></span><span class="op">(</span><span class="va">dsgn</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, seed <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h3>
<p>Summary statistics of the original and simulated datasets.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      Gender           Age             Race           Weight      </span></span>
<span><span class="co">##  Min.   :1.000   Min.   :19.00   Min.   :1.000   Min.   : 39.30  </span></span>
<span><span class="co">##  1st Qu.:1.000   1st Qu.:32.00   1st Qu.:3.000   1st Qu.: 66.58  </span></span>
<span><span class="co">##  Median :1.000   Median :46.00   Median :4.000   Median : 79.40  </span></span>
<span><span class="co">##  Mean   :1.494   Mean   :46.97   Mean   :3.539   Mean   : 81.88  </span></span>
<span><span class="co">##  3rd Qu.:2.000   3rd Qu.:60.00   3rd Qu.:4.000   3rd Qu.: 93.20  </span></span>
<span><span class="co">##  Max.   :2.000   Max.   :80.00   Max.   :5.000   Max.   :198.70  </span></span>
<span><span class="co">##       BMI            BPsys           BPdia       </span></span>
<span><span class="co">##  Min.   :15.70   Min.   : 74.0   Min.   :  0.00  </span></span>
<span><span class="co">##  1st Qu.:23.80   1st Qu.:110.0   1st Qu.: 64.00  </span></span>
<span><span class="co">##  Median :27.60   Median :120.0   Median : 72.00  </span></span>
<span><span class="co">##  Mean   :28.57   Mean   :122.2   Mean   : 71.63  </span></span>
<span><span class="co">##  3rd Qu.:31.90   3rd Qu.:132.0   3rd Qu.: 78.00  </span></span>
<span><span class="co">##  Max.   :80.60   Max.   :224.0   Max.   :110.00</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">simdf_auto</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      Gender           Age             Race           Weight      </span></span>
<span><span class="co">##  Min.   :1.000   Min.   :19.00   Min.   :1.000   Min.   : 39.30  </span></span>
<span><span class="co">##  1st Qu.:1.000   1st Qu.:32.00   1st Qu.:3.000   1st Qu.: 65.50  </span></span>
<span><span class="co">##  Median :1.000   Median :46.00   Median :4.000   Median : 78.90  </span></span>
<span><span class="co">##  Mean   :1.499   Mean   :46.72   Mean   :3.522   Mean   : 81.04  </span></span>
<span><span class="co">##  3rd Qu.:2.000   3rd Qu.:60.00   3rd Qu.:4.000   3rd Qu.: 92.49  </span></span>
<span><span class="co">##  Max.   :2.000   Max.   :80.00   Max.   :5.000   Max.   :143.60  </span></span>
<span><span class="co">##       BMI            BPsys           BPdia       </span></span>
<span><span class="co">##  Min.   :15.70   Min.   : 74.0   Min.   :  0.00  </span></span>
<span><span class="co">##  1st Qu.:23.60   1st Qu.:112.0   1st Qu.: 64.00  </span></span>
<span><span class="co">##  Median :27.30   Median :120.0   Median : 72.00  </span></span>
<span><span class="co">##  Mean   :28.34   Mean   :122.0   Mean   : 71.31  </span></span>
<span><span class="co">##  3rd Qu.:31.90   3rd Qu.:132.0   3rd Qu.: 78.00  </span></span>
<span><span class="co">##  Max.   :48.23   Max.   :174.6   Max.   :102.00</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">simdf</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      Gender            Age             Race           Weight      </span></span>
<span><span class="co">##  Min.   :0.0000   Min.   :16.01   Min.   :1.000   Min.   : 27.56  </span></span>
<span><span class="co">##  1st Qu.:0.0000   1st Qu.:32.10   1st Qu.:4.000   1st Qu.: 66.90  </span></span>
<span><span class="co">##  Median :1.0000   Median :46.05   Median :4.000   Median : 79.85  </span></span>
<span><span class="co">##  Mean   :0.5098   Mean   :46.85   Mean   :3.542   Mean   : 81.75  </span></span>
<span><span class="co">##  3rd Qu.:1.0000   3rd Qu.:60.21   3rd Qu.:4.000   3rd Qu.: 94.44  </span></span>
<span><span class="co">##  Max.   :1.0000   Max.   :82.91   Max.   :5.000   Max.   :175.01  </span></span>
<span><span class="co">##       BMI            BPsys            BPdia       </span></span>
<span><span class="co">##  Min.   :12.57   Min.   : 67.03   Min.   : 34.98  </span></span>
<span><span class="co">##  1st Qu.:23.90   1st Qu.:111.23   1st Qu.: 64.42  </span></span>
<span><span class="co">##  Median :27.67   Median :121.13   Median : 71.99  </span></span>
<span><span class="co">##  Mean   :28.53   Mean   :122.61   Mean   : 72.00  </span></span>
<span><span class="co">##  3rd Qu.:32.44   3rd Qu.:132.88   3rd Qu.: 79.73  </span></span>
<span><span class="co">##  Max.   :56.66   Max.   :189.50   Max.   :115.30</span></span></code></pre>
<p>Correlation structures of the original and simulated datasets.</p>
<p><img src="NORTA_demo_files/figure-html/unnamed-chunk-8-1.png" width="700"><img src="NORTA_demo_files/figure-html/unnamed-chunk-8-2.png" width="700"><img src="NORTA_demo_files/figure-html/unnamed-chunk-8-3.png" width="700"></p>
<p>We may also inspect the continuous variables regarding their
univariate and bivariate distributions. The original data is shown in
black, the simulated data is shown in red. (Note that we only use the
first 1000 observations to speed up the plotting.)</p>
<p><img src="NORTA_demo_files/figure-html/unnamed-chunk-9-1.png" width="700"><img src="NORTA_demo_files/figure-html/unnamed-chunk-9-2.png" width="700"></p>
<p>From this we can observe, that the agreement between the original
data and the simulated data is generally quite good. Both, automated and
manual specification work equally well for this dataset. Note, however,
that e.g. the slightly non-linear relationship between age and diastolic
blood pressure cannot be fully captured by the approach, as expected.
Furthermore, the original data shows some outliers, which are also not
reproducible due to the parametric nature of the NORTA procedure.</p>
</div>
</div>
<div class="section level2">
<h2 id="rsession">R session information<a class="anchor" aria-label="anchor" href="#rsession"></a>
</h2>
<pre><code><span><span class="co">## R version 4.4.2 (2024-10-31)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">## Running under: Ubuntu 22.04.5 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">##  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">## [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: UTC</span></span>
<span><span class="co">## tzcode source: system (glibc)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] ggcorrplot_0.1.4.1 patchwork_1.3.0    ggplot2_3.5.1      dplyr_1.1.4       </span></span>
<span><span class="co">## [5] fitdistrplus_1.2-1 survival_3.7-0     MASS_7.3-61        NHANES_2.1.0      </span></span>
<span><span class="co">## [9] simdata_0.4.1     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] sass_0.4.9        utf8_1.2.4        generics_0.1.3    stringi_1.8.4    </span></span>
<span><span class="co">##  [5] lattice_0.22-6    digest_0.6.37     magrittr_2.0.3    evaluate_1.0.1   </span></span>
<span><span class="co">##  [9] grid_4.4.2        mvtnorm_1.3-2     fastmap_1.2.0     plyr_1.8.9       </span></span>
<span><span class="co">## [13] jsonlite_1.8.9    Matrix_1.7-1      fansi_1.0.6       scales_1.3.0     </span></span>
<span><span class="co">## [17] textshaping_0.4.0 jquerylib_0.1.4   cli_3.6.3         rlang_1.1.4      </span></span>
<span><span class="co">## [21] munsell_0.5.1     splines_4.4.2     withr_3.0.2       cachem_1.1.0     </span></span>
<span><span class="co">## [25] yaml_2.3.10       tools_4.4.2       reshape2_1.4.4    colorspace_2.1-1 </span></span>
<span><span class="co">## [29] vctrs_0.6.5       R6_2.5.1          lifecycle_1.0.4   stringr_1.5.1    </span></span>
<span><span class="co">## [33] fs_1.6.5          ragg_1.3.3        pkgconfig_2.0.3   desc_1.4.3       </span></span>
<span><span class="co">## [37] pkgdown_2.1.1     pillar_1.9.0      bslib_0.8.0       gtable_0.3.6     </span></span>
<span><span class="co">## [41] glue_1.8.0        Rcpp_1.0.13-1     systemfonts_1.1.0 xfun_0.49        </span></span>
<span><span class="co">## [45] tibble_3.2.1      tidyselect_1.2.1  knitr_1.49        farver_2.1.2     </span></span>
<span><span class="co">## [49] htmltools_0.5.8.1 labeling_0.4.3    rmarkdown_2.29    compiler_4.4.2</span></span></code></pre>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-NORTA1" class="csl-entry">
Cario, Marne C., and Barry L. Nelson. 1997. <span>“Modeling and
Generating Random Vectors with Arbitrary Marginal Distributions and
Correlation Matrix.”</span> Report. Northwestern University.
</div>
<div id="ref-NORTA2" class="csl-entry">
Ghosh, Soumyadip, and Shane G. Henderson. 2003. <span>“Behavior of the
NORTA Method for Correlated Random Vector Generation as the Dimension
Increases.”</span> <em>ACM Trans. Model. Comput. Simul.</em> 13 (3):
276–94. <a href="https://doi.org/10.1145/937332.937336" class="external-link">https://doi.org/10.1145/937332.937336</a>.
</div>
<div id="ref-Synthpop" class="csl-entry">
Nowok, Beata, Gillian M. Raab, and Chris Dibben. 2016. <span>“Synthpop:
Bespoke Creation of Synthetic Data in r.”</span> <em>Journal of
Statistical Software, Articles</em> 74 (11): 1–26. <a href="https://doi.org/10.18637/jss.v074.i11" class="external-link">https://doi.org/10.18637/jss.v074.i11</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michael Kammer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
